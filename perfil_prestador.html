<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Perfil do Prestador | Connect Work</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <header>
    <div class="container">
      <h1>Connect Work</h1>
      <nav>
        <ul class="menu">
          <li><a href="index.html">Início</a></li>
          <li><a href="cadastro.html">Cadastro</a></li>
          <li><a href="login.html">Login</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="perfil-container">
    <!-- Bloco lateral esquerdo -->
    <section class="dados-pessoais">
      <h2>Meu Perfil</h2>
      <div class="foto-perfil">
        <label for="foto">
          <img id="preview-foto" src="https://via.placeholder.com/150" alt="Foto de perfil">
          <p>Alterar foto</p>
        </label>
        <input type="file" id="foto" name="foto" accept="image/*" style="display: none;">
        <h3 id="nome-exibido">Nome do Usuário</h3>
        <div class="avaliacao-prestador">
          <span class="estrelas">
            <i class="fas fa-star estrela"></i>
            <i class="fas fa-star estrela"></i>
            <i class="fas fa-star estrela"></i>
            <i class="fas fa-star estrela"></i>
            <i class="fas fa-star estrela"></i>
          </span>
          <span class="nota-media" id="nota-media">5.0</span>
        </div>
      </div>

      <div class="perfil-info">
        <div class="info-item" data-campo="nome">
          <strong>Nome:</strong>
          <span class="texto" id="nome-texto"></span>
          <i class="fa fa-pencil-alt editar"></i>
          <div class="edicao hidden">
            <input type="text" id="input-nome">
            <button class="salvar">Salvar</button>
            <button class="cancelar">Cancelar</button>
          </div>
        </div>

        <div class="info-item" data-campo="email">
          <strong>Email:</strong>
          <span class="texto" id="email-texto"></span>
          <i class="fa fa-pencil-alt editar"></i>
          <div class="edicao hidden">
            <input type="email" id="input-email">
            <button class="salvar">Salvar</button>
            <button class="cancelar">Cancelar</button>
          </div>
        </div>

        <div class="info-item" data-campo="telefone">
          <strong>Telefone:</strong>
          <span class="texto" id="telefone-texto"></span>
          <i class="fa fa-pencil-alt editar"></i>
          <div class="edicao hidden">
            <input type="tel" id="input-telefone">
            <button class="salvar">Salvar</button>
            <button class="cancelar">Cancelar</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Bloco central-direito -->
    <div class="bloco-direita">
      <section class="portfolio-box">
        <h2>Portfólio</h2>
        <form id="portfolio-form">
          <div class="form-group">
            <label for="descricao-portfolio">Descrição do trabalho</label>
            <textarea id="descricao-portfolio" rows="4" placeholder="Fale um pouco sobre sua experiência..."></textarea>
          </div>

          <div class="form-group">
            <label for="imagens-portfolio">Anexar imagens</label>
            <input type="file" id="imagens-portfolio" accept="image/*" multiple>
            <div id="preview-imagens" class="preview-imagens"></div>
          </div>

          <button type="submit" class="btn-cadastro">Salvar Portfólio</button>
        </form>
      </section>

      <section class="endereco-box">
  <h2>Endereço de Atuação</h2>
  <form id="form-endereco">
    <div class="form-group">
      <label for="cep">CEP:</label>
      <input type="text" id="cep" name="cep" required maxlength="9">
    </div>

    <div class="form-group">
      <label for="rua">Rua:</label>
      <input type="text" id="rua" name="rua" required>
    </div>

    <div class="form-group">
      <label for="numero">Número:</label>
      <input type="text" id="numero" name="numero" required>
    </div>

    <div class="form-group">
      <label for="bairro">Bairro:</label>
      <input type="text" id="bairro" name="bairro" required>
    </div>

    <div class="form-group">
      <label for="cidade">Cidade:</label>
      <input type="text" id="cidade" name="cidade" required>
    </div>

    <div class="form-group">
      <label for="pais">País:</label>
      <input type="text" id="pais" name="pais" value="Brasil" required>
    </div>

    <div class="form-group">
      <label for="observacao">Observação:</label>
      <textarea id="observacao" name="observacao" rows="3" placeholder="Ponto de referência, complemento..."></textarea>
    </div>

    <button type="submit" class="btn-cadastro">Salvar Endereço</button>
  </form>
</section>


      <section class="agenda-box">
        <h2>Agenda de Disponibilidade</h2>
        <form id="agenda-form" class="agenda-form">
          <input type="date" id="data-agenda" required>
          <input type="time" id="hora-inicial" required>
          <input type="time" id="hora-final" required>
          <button type="submit" class="btn-cadastro">Adicionar Horário</button>
        </form>

        <div class="agenda-lista">
          <h3>Horários Cadastrados</h3>
          <div id="lista-agenda"></div>
        </div>
      </section>
    </div>

   <section class="servicos-box">
  <h2>Serviços Agendados</h2>
  <div id="lista-servicos"></div>

  <!-- Modal Detalhes -->
  <div id="modal-detalhes" class="modal hidden">
    <div class="modal-conteudo">
      <h3>Descrição do Serviço</h3>
      <p id="descricao-detalhes"></p>
      <button onclick="fecharModal()">Fechar</button>
    </div>
  </div>

  <!-- Modal Justificativa -->
  <div id="modal-justificativa" class="modal hidden">
    <div class="modal-conteudo">
      <h3 id="modal-titulo"></h3>
      <textarea id="campo-justificativa" placeholder="Informe a justificativa..."></textarea>
      <div class="modal-acoes">
        <button onclick="confirmarJustificativa()">Confirmar</button>
        <button onclick="fecharModalJustificativa()">Cancelar</button>
      </div>
    </div>
  </div>
</section>


  </main>

  <footer>
    <div class="container">
      <p>&copy; 2025 Connect Work</p>
    </div>
  </footer>

  <script>
    const previewFoto = document.getElementById('preview-foto');
    const inputFoto = document.getElementById('foto');
    const nomeExibido = document.getElementById('nome-exibido');

    inputFoto.addEventListener('change', function () {
      const file = inputFoto.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function (e) {
          previewFoto.src = e.target.result;
          localStorage.setItem('fotoPerfil', e.target.result);
        };
        reader.readAsDataURL(file);
      }
    });

    function carregarPerfil() {
      const perfil = JSON.parse(localStorage.getItem('perfilPrestador')) || {};
      document.getElementById('nome-texto').textContent = perfil.nome || '';
      document.getElementById('email-texto').textContent = perfil.email || '';
      document.getElementById('telefone-texto').textContent = perfil.telefone || '';
      nomeExibido.textContent = perfil.nome || 'Nome do Usuário';
      const foto = localStorage.getItem('fotoPerfil');
      if (foto) previewFoto.src = foto;
    }

    // CORRIGIDO: manipulação dos campos de edição
    document.querySelectorAll('.info-item').forEach(item => {
      const campo = item.dataset.campo;
      const editar = item.querySelector('.editar');
      const salvar = item.querySelector('.salvar');
      const cancelar = item.querySelector('.cancelar');
      const texto = item.querySelector('.texto');
      const input = item.querySelector(`input[id="input-${campo}"]`);
      const edicao = item.querySelector('.edicao');

      editar.addEventListener('click', () => {
        edicao.classList.remove('hidden');
        input.value = texto.textContent;
        texto.style.display = 'none';
        editar.style.display = 'none';
      });

      cancelar.addEventListener('click', () => {
        edicao.classList.add('hidden');
        texto.style.display = 'inline';
        editar.style.display = 'inline-block';
      });

      salvar.addEventListener('click', () => {
        texto.textContent = input.value;
        edicao.classList.add('hidden');
        texto.style.display = 'inline';
        editar.style.display = 'inline-block';
        const perfil = JSON.parse(localStorage.getItem('perfilPrestador')) || {};
        perfil[campo] = input.value;
        localStorage.setItem('perfilPrestador', JSON.stringify(perfil));
        if (campo === 'nome') nomeExibido.textContent = input.value;
      });
    });

    carregarPerfil();

    // Portfólio
    const formPortfolio = document.getElementById('portfolio-form');
    const inputDescricao = document.getElementById('descricao-portfolio');
    const inputImagens = document.getElementById('imagens-portfolio');
    const previewImagens = document.getElementById('preview-imagens');

    inputImagens.addEventListener('change', () => {
      previewImagens.innerHTML = '';
      const arquivos = inputImagens.files;
      for (let i = 0; i < arquivos.length; i++) {
        const reader = new FileReader();
        reader.onload = function (e) {
          const img = document.createElement('img');
          img.src = e.target.result;
          img.classList.add('miniatura');
          previewImagens.appendChild(img);
        };
        reader.readAsDataURL(arquivos[i]);
      }
    });

    formPortfolio.addEventListener('submit', (e) => {
      e.preventDefault();
      const descricao = inputDescricao.value;
      const imagens = [];
      const arquivos = inputImagens.files;
      const promises = [];
      for (let i = 0; i < arquivos.length; i++) {
        const reader = new FileReader();
        const p = new Promise((resolve) => {
          reader.onload = function (e) {
            imagens.push(e.target.result);
            resolve();
          };
          reader.readAsDataURL(arquivos[i]);
        });
        promises.push(p);
      }
      Promise.all(promises).then(() => {
        const portfolioData = { descricao, imagens };
        localStorage.setItem('portfolioPrestador', JSON.stringify(portfolioData));
        alert("Portfólio salvo com sucesso!");
      });
    });

    window.addEventListener('DOMContentLoaded', () => {
      const salvo = localStorage.getItem('portfolioPrestador');
      if (salvo) {
        const data = JSON.parse(salvo);
        inputDescricao.value = data.descricao || '';
        if (data.imagens) {
          previewImagens.innerHTML = '';
          data.imagens.forEach(src => {
            const img = document.createElement('img');
            img.src = src;
            img.classList.add('miniatura');
            previewImagens.appendChild(img);
          });
        }
      }
    });

    // Agenda
    const formAgenda = document.getElementById('agenda-form');
    const dataInput = document.getElementById('data-agenda');
    const horaInicioInput = document.getElementById('hora-inicial');
    const horaFimInput = document.getElementById('hora-final');
    const listaAgenda = document.getElementById('lista-agenda');

    function renderizarAgenda() {
      const agendamentos = JSON.parse(localStorage.getItem('agendaPrestador')) || [];
      const agrupado = {};

      agendamentos.forEach((item, index) => {
        if (!agrupado[item.data]) agrupado[item.data] = [];
        agrupado[item.data].push({ ...item, index });
      });

      listaAgenda.innerHTML = '';
      Object.keys(agrupado).sort().forEach(data => {
        const diaDiv = document.createElement('div');
        diaDiv.classList.add('dia-agenda');
        const titulo = document.createElement('h4');
        titulo.textContent = new Date(data).toLocaleDateString();
        diaDiv.appendChild(titulo);

        agrupado[data].forEach(({ horaInicio, horaFim, index }) => {
          const bloco = document.createElement('div');
          bloco.classList.add('bloco-horario');
          bloco.innerHTML = `
            <span>${horaInicio} às ${horaFim}</span>
            <button onclick="editarHorario(${index})">Editar</button>
            <button onclick="excluirHorario(${index})">Excluir</button>
          `;
          diaDiv.appendChild(bloco);
        });

        listaAgenda.appendChild(diaDiv);
      });
    }

    formAgenda.addEventListener('submit', (e) => {
      e.preventDefault();
      const data = dataInput.value;
      const horaInicio = horaInicioInput.value;
      const horaFim = horaFimInput.value;
      const agendamentos = JSON.parse(localStorage.getItem('agendaPrestador')) || [];
      agendamentos.push({ data, horaInicio, horaFim });
      localStorage.setItem('agendaPrestador', JSON.stringify(agendamentos));
      formAgenda.reset();
      renderizarAgenda();
    });

    function excluirHorario(index) {
      const agendamentos = JSON.parse(localStorage.getItem('agendaPrestador')) || [];
      agendamentos.splice(index, 1);
      localStorage.setItem('agendaPrestador', JSON.stringify(agendamentos));
      renderizarAgenda();
    }

    function editarHorario(index) {
      const agendamentos = JSON.parse(localStorage.getItem('agendaPrestador')) || [];
      const item = agendamentos[index];
      dataInput.value = item.data;
      horaInicioInput.value = item.horaInicio;
      horaFimInput.value = item.horaFim;
      agendamentos.splice(index, 1);
      localStorage.setItem('agendaPrestador', JSON.stringify(agendamentos));
      renderizarAgenda();
    }

    renderizarAgenda();

    // Simulação de serviços agendados
let servicos = [
  {
    data: "2025-06-10",
    hora: "14:00",
    cliente: "João Silva",
    descricao: "Instalação de prateleiras em apartamento",
  },
  {
    data: "2025-06-12",
    hora: "10:30",
    cliente: "Maria Oliveira",
    descricao: "Reparo elétrico na cozinha",
  }
];

const listaServicos = document.getElementById('lista-servicos');
const modalDetalhes = document.getElementById('modal-detalhes');
const descricaoDetalhes = document.getElementById('descricao-detalhes');

const modalJustificativa = document.getElementById('modal-justificativa');
const campoJustificativa = document.getElementById('campo-justificativa');
const modalTitulo = document.getElementById('modal-titulo');

let tipoAcao = '';
let servicoSelecionado = null;

function renderizarServicos() {
  listaServicos.innerHTML = '';
  servicos.forEach((serv, index) => {
    const card = document.createElement('div');
    card.classList.add('card-servico');
    card.innerHTML = `
      <span><strong>Data:</strong> ${new Date(serv.data).toLocaleDateString()}</span>
      <span><strong>Hora:</strong> ${serv.hora}</span>
      <span><strong>Cliente:</strong> ${serv.cliente}</span>
      <div class="acoes">
        <button class="detalhes" onclick="abrirDetalhes('${serv.descricao}')">Detalhes</button>
        <button class="editar" onclick="abrirJustificativa('editar', ${index})">Editar</button>
        <button class="cancelar" onclick="abrirJustificativa('cancelar', ${index})">Cancelar</button>
      </div>
    `;
    listaServicos.appendChild(card);
  });
}

function abrirDetalhes(descricao) {
  descricaoDetalhes.textContent = descricao;
  modalDetalhes.classList.remove('hidden');
}

function fecharModal() {
  modalDetalhes.classList.add('hidden');
}

function abrirJustificativa(acao, index) {
  tipoAcao = acao;
  servicoSelecionado = index;
  campoJustificativa.value = '';
  modalTitulo.textContent = acao === 'cancelar' ? 'Justificativa de Cancelamento' : 'Justificativa de Edição';
  modalJustificativa.classList.remove('hidden');
}

function fecharModalJustificativa() {
  modalJustificativa.classList.add('hidden');
  tipoAcao = '';
  servicoSelecionado = null;
}

function confirmarJustificativa() {
  const justificativa = campoJustificativa.value.trim();
  if (justificativa === '') {
    alert('Por favor, informe a justificativa.');
    return;
  }

  if (tipoAcao === 'cancelar') {
    alert(`Serviço cancelado.\nJustificativa: ${justificativa}`);
    servicos.splice(servicoSelecionado, 1);
  } else if (tipoAcao === 'editar') {
    const novaData = prompt("Nova data (aaaa-mm-dd):", servicos[servicoSelecionado].data);
    const novaHora = prompt("Novo horário (hh:mm):", servicos[servicoSelecionado].hora);
    if (novaData && novaHora) {
      servicos[servicoSelecionado].data = novaData;
      servicos[servicoSelecionado].hora = novaHora;
      alert(`Serviço editado.\nJustificativa: ${justificativa}`);
    }
  }

  fecharModalJustificativa();
  renderizarServicos();
}

renderizarServicos();

// Preencher endereço via ViaCEP
document.getElementById('cep').addEventListener('blur', () => {
  const cep = document.getElementById('cep').value.replace(/\D/g, '');
  if (cep.length === 8) {
    fetch(`https://viacep.com.br/ws/${cep}/json/`)
      .then(res => res.json())
      .then(data => {
        if (!data.erro) {
          document.getElementById('rua').value = data.logradouro || '';
          document.getElementById('bairro').value = data.bairro || '';
          document.getElementById('cidade').value = data.localidade || '';
        } else {
          alert('CEP não encontrado.');
        }
      })
      .catch(() => alert('Erro ao consultar o CEP.'));
  }
});

// Salvar endereço no localStorage
document.getElementById('form-endereco').addEventListener('submit', (e) => {
  e.preventDefault();
  const endereco = {
    cep: document.getElementById('cep').value,
    rua: document.getElementById('rua').value,
    numero: document.getElementById('numero').value,
    bairro: document.getElementById('bairro').value,
    cidade: document.getElementById('cidade').value,
    pais: document.getElementById('pais').value,
    observacao: document.getElementById('observacao').value,
  };
  localStorage.setItem('enderecoPrestador', JSON.stringify(endereco));
  alert("Endereço salvo com sucesso!");
});

// Carregar endereço salvo
window.addEventListener('DOMContentLoaded', () => {
  const dados = JSON.parse(localStorage.getItem('enderecoPrestador'));
  if (dados) {
    document.getElementById('cep').value = dados.cep || '';
    document.getElementById('rua').value = dados.rua || '';
    document.getElementById('numero').value = dados.numero || '';
    document.getElementById('bairro').value = dados.bairro || '';
    document.getElementById('cidade').value = dados.cidade || '';
    document.getElementById('pais').value = dados.pais || 'Brasil';
    document.getElementById('observacao').value = dados.observacao || '';
  }
});

    
  </script>
</body>
</html>
